// base.config
// use this config file to modify process resource allocation


// PROCESS RESOURCES
process {

	// top-level configuration groups
	withLabel: "low" {
    	time = { 8.h * task.attempt }
    	memory = { 2.GB * task.attempt }
    	cpus = 2
	}

	withLabel: "tiny" {
		time = 2.h
		memory = 500.MB
		cpus = 1
	}

	withLabel: "finish" {
    	errorStrategy = { task.exitStatus in [140,143,137,104,134,139] ? 'retry' : 'finish' }
	}

	withLabel: "ignore" {
    	errorStrategy = { task.exitStatus in [140,143,137,104,134,139] ? 'retry' : 'ignore' }
	}


	// configuration for building genome index for erne-bs5
	withName: "process_cov_and_env_files" {
	
		// label 'low'
		// label 'finish'
		maxRetries = 1
	}


	// configuration for building genome index for segemehl
	withName: "process_gxe_file" {
	
		// label 'low'
		// label 'finish'
		maxRetries = 1
	}


	// configuration for building directories for input reads
	withName: "process_input_files_meth_calls" {
	
		// label 'tiny'
		// label 'finish'
		maxRetries = 1
	}
	
	// configuration for building directories for merge reads
	withName: "process_bedtools_unionbedg_methcalls2" {
	
		// label 'tiny'
		// label 'finish'
		maxRetries = 1
	}


	// configuration for trimming reads
	withName: "process_bedtools_unionbedg_methcalls3" {

		// label 'low'
		// label 'finish'
		cpus = { params.SE ? '1' : '2' }
		maxRetries = 1
	}


	// configuration for merging input + merge reads
	withName: "process_GEM_Emodel_run_meth_calls" {

		// label 'tiny'
		// label 'finish'
		memory = { 250.MB * task.attempt }
		cpus = { params.SE ? '1' : '2' }
		maxRetries = 1
	}


	// configuration for fastqc
	withName: "process_bedtools_unionbedg_DMPs" {

		// label 'tiny'
		// label 'ignore'
		cpus = { params.SE ? '1' : '2' }
		maxRetries = 1
	}

	// configuration for "erne-bs5" alignment
	withName: "process_bedtools_intersect_DMP" {

		// label 'finish'
    	time = { 12.h * task.attempt }
    	memory = { 2.GB * task.attempt }
    	cpus = { 8 * task.attempt }
    	maxRetries = 2
	}

	// configuration for "process_GEM_Emodel_run_DMPs" alignment
	withName: "process_GEM_Emodel_run_DMPs" {

		// label 'finish'
    	time = { 2.d * task.attempt }
    	memory = { 24.GB * task.attempt }
    	cpus = { 8 * task.attempt }
    	maxRetries = 2
	}


	// configuration for "erne-bs5" post-processing
	withName: "process_bedtools_unionbedg_DMRs" {

		// label 'finish'		
		time = { 16.h * task.attempt }
		memory = { 14.GB * task.attempt }
		cpus = { 4 * task.attempt }    
		maxRetries = 2
	}


	// configuration for "segemehl" post-processing
	withName: "process_bedtools_intersect_DMR" {
	
		// label 'low'
		// label 'finish'
		maxRetries = 1	
	}


	// configuration for bam merging
	withName: "process_GEM_Emodel_run_DMRs" {
	
		// label 'low'
		// label 'finish'
		maxRetries = 1
	}
	}
