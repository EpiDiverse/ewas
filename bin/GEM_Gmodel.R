#!/usr/bin/env R

suppressMessages(require(ggplot2))
suppressMessages(require(Rcpp))
suppressMessages(require(digest))
suppressMessages(require(devtools))
suppressMessages(require(usethis))
#suppressMessages(require(GEM))
#loadNamespace(GEM)

##################################
args <- commandArgs(trailingOnly=T)
source(paste(args[1],"GEM_model.R",sep="/"))
source(paste(args[1],"Matrix_eQTL_engine3.R",sep="/"))
environment(my.GEM_Gmodel) <- asNamespace("GEM")
environment(Matrix_eQTL_engine3) <- asNamespace("GEM")
environment(.OutputSaver_NEW) <- asNamespace("GEM")
##################################

snp= paste(".", args[2], sep="/")
cov= paste(".", args[3], sep="/")
meth= paste(".", args[4], sep="/")
p= as.numeric(args[5])

#main.nf takes p_value as an integer, but GEM process converts it into string. before this, this value be converted into int again. 
gmodel_txt = paste("./", args[6], ".txt", sep="")

my.GEM_Gmodel(snp, cov, meth, p, gmodel_txt, noFDR=TRUE)
